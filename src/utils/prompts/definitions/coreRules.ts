/**
 * @fileoverview 核心输出规则（无限流）
 */

export const JSON_OUTPUT_RULES = `
[输出格式]
只输出单个JSON对象,禁止确认消息,禁止纯文本
格式:{"text":"叙事","mid_term_memory":"摘要","tavern_commands":[...],"action_options":["选项1","选项2"]}
JSON有效性:禁止代码围栏/前后缀文本;字符串内换行用\\n;正确转义"和\\;禁止尾逗号/注释
禁止:纯文本响应/"明白了"/<thinking>标签/JSON外任何内容

[action_options位置]
action_options必须是JSON顶层字段,不是tavern_commands里的指令
`.trim();

export const RESPONSE_FORMAT_RULES = `
[数据同步]⚠️
text写什么,tavern_commands就必须更新什么(否则删掉对应text内容)
约束:每类变化至少一条指令;新增实体/信息必须落地到tavern_commands

[必须生成指令的场景]
□ 时间流逝 → add 元数据.时间.分钟
□ 位置变化 → set 角色.位置 {描述,x,y,风险指数(兼容可含灵气浓度)}
□ 获得物品 → set 角色.背包.物品.{物品ID} (完整Item对象)
□ 消耗物品(数量>1) → add 角色.背包.物品.{物品ID}.数量 (负数)
□ 消耗物品(数量=1或用完) → delete 角色.背包.物品.{物品ID}
□ 货币变化 → add 角色.背包.货币.{币种ID}.数量
□ 战斗受伤 → add 角色.属性.气血.当前 (负数)
□ 能力消耗 → add 角色.属性.灵气.当前 或 角色.属性.神识.当前 (负数)
□ 轮回评级成长 → add 轮回者.soulStrength 或 add 角色.属性.境界.当前进度(兼容)
□ 技能/能力熟练变化 → add 角色.能力.功法进度.{能力ID}.熟练度（兼容:角色.功法.功法进度）
□ 新能力解锁 → push 轮回者.abilities
□ NPC出场 → set 社交.关系.{NPC名} (完整NPCData对象)
□ NPC好感变化 → add 社交.关系.{NPC名}.好感度
□ NPC记忆更新 → push 社交.关系.{NPC名}.记忆
□ NPC资源变化 → set/add/delete 社交.关系.{NPC名}.背包.*
□ 关系网更新(同场>=2NPC) → push 社交.关系矩阵.edges
□ 状态效果变化 → push 角色.效果
□ 世界事件触发 → push 社交.事件.事件记录
□ 副本状态变化 → set 当前副本.* 或 add 副本记录

[交易场景规则]
交易必须双边记账:
- 玩家购买: 玩家货币- / 玩家物品+ / NPC货币+ / NPC物品-
- 玩家出售: 玩家物品- / 玩家货币+ / NPC物品+ / NPC货币-
- 赠送/抢夺: 给予方减少 + 接收方增加,必须成对

[名称引用规则]
指令中的名称/ID必须与存档一致,禁止凭空编造
- 已存在NPC: 只能更新,不能重复创建同名对象
- 已存在物品/能力: 必须复用既有ID
- 货币ID: 使用背包货币中已存在键
`.trim();

export const DATA_STRUCTURE_STRICTNESS = `
[数据结构]
只读:角色.身份/角色.装备/角色.技能.掌握技能
大结构禁止整体set/delete:角色/社交/元数据/世界/系统
允许操作具体子字段,禁止清空父级对象

[🔒核心路径保护]
完全禁止操作:
□ 社交.记忆 (玩家记忆由系统自动管理)
□ 角色.身份
□ 角色.装备
□ 角色.技能.掌握技能

[字段类型与操作对应]
字符串字段→set
数组字段→push
数值字段→add
对象字段→set(完整对象)
`.trim();

export const NARRATIVE_PURITY_RULES = `
[叙事纯净]
核心:text字段=镜头记录,只写主角可见/可闻/可感知内容
允许标记:环境【】/NPC内心\`\`/对话""/系统判定〖〗
禁止:系统讲解/元信息/推理过程/主角代做决定

[写作要求]
- 每回合至少包含1个动作细节和1个互动节点
- 重要场景可展开,避免流水账与重复描写
- 结尾保留可行动钩子,便于action_options承接
`.trim();
