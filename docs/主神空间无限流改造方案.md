# 仙途 → 主神空间无限流 改造方案

> 本文档梳理了将「仙途」（AI 修仙文字冒险）改造为「类主神空间无限流文字游戏」的所有关键改造点。
> 后续开发将以本文档为蓝图逐步推进。
>
> **最后检查时间：2026-02-23（二次核验）**
>
> ### 改造总进度一览
>
> | 章节 | 状态 | 说明 |
> |------|------|------|
> | 2. 核心架构 | ✅ 已完成 | 游戏状态机、存档结构已改造 |
> | 3. 世界系统 | ✅ 已完成 | 主神空间/副本模板/世界生成器/地图路由均已改造 |
> | 4. 角色系统 | ⚠️ 大部分完成 | 创建流程 3 步、六维属性、轮回者等级、灵魂强度/晋升逻辑已实现；attributeCalculation 仍有旧路径 |
> | 5. 副本任务系统 | ✅ 已完成 | store/生成器/校验器/UI 面板全部就位 |
> | 6. 经济与积分 | ✅ 已完成 | 神点体系已实现，兑换商店已建 |
> | 7. 成长与能力 | ⚠️ 大部分完成 | 能力面板/能力树 UI 与底层数据已统一；craftingSystem 仍为修仙炼丹/炼器体系 |
> | 8. NPC 与社交 | ✅ 已完成 | 队伍系统、空间常驻 NPC、关系网络面板均已适配无限流 |
> | 9. AI Prompt | ✅ 已完成 | 核心规则重写，5 个新 prompt 模块全部注册并扩充（共 560 行），promptAssembler 支持空间/副本双模式 |
> | 10. UI/UX | ✅ 已完成 | 8 个新组件就位，CharacterDetails/Inventory/TopBar/RightSidebar 已适配无限流 |
> | 11. 数据结构 | ✅ 已完成 | types/存档结构已改造，saveMigration 已覆盖新旧转换 |

---

## 目录

1. [概念对比：修仙 vs 无限流](#1-概念对比修仙-vs-无限流)
2. [核心架构改造](#2-核心架构改造)
3. [世界系统改造](#3-世界系统改造)
4. [角色系统改造](#4-角色系统改造)
5. [副本任务系统（新增）](#5-副本任务系统新增)
6. [经济与积分系统](#6-经济与积分系统)
7. [成长与能力系统](#7-成长与能力系统)
8. [NPC 与社交系统](#8-npc-与社交系统)
9. [AI Prompt 系统改造](#9-ai-prompt-系统改造)
10. [UI/UX 改造](#10-uiux-改造)
11. [数据结构改造（types/存档）](#11-数据结构改造types存档)
12. [技术复用评估](#12-技术复用评估)
13. [改造优先级与里程碑](#13-改造优先级与里程碑)

---

## 1. 概念对比：修仙 vs 无限流

| 维度 | 仙途（当前） | 主神空间无限流（目标） |
|------|-------------|---------------------|
| **核心循环** | 开放世界修仙，境界突破 | 主神空间 ↔ 副本世界，完成任务求生 |
| **世界观** | 单一修仙大世界（朝天大陆等） | 主神空间（中心枢纽）+ 无数副本世界 |
| **驱动力** | 追求长生、大道 | 生存压力 + 变强回家/揭秘主神 |
| **成长方式** | 境界突破（练气→渡劫） | 神点兑换 + 副本奖励 + 跨世界能力积累 |
| **时间线** | 线性连续（游戏时间流逝） | 副本内独立时间 + 主神空间休整期 |
| **NPC** | 宗门、散修、势力网络 | 主神空间常驻 + 副本内临时 + 轮回者同伴/敌人 |
| **死亡惩罚** | 游戏结束 | 副本失败 = 抹杀（真·游戏结束） |

---

## 2. 核心架构改造

### 2.1 游戏状态机改造 ✅ 已完成

当前游戏只有一种状态：**开放世界探索**。改造后需要引入两种核心状态：

```
┌──────────────┐     任务开始      ┌──────────────┐
│   主神空间    │ ──────────────→  │   副本世界    │
│  (Hub State)  │ ←──────────────  │ (Mission State)│
└──────────────┘     任务结算      └──────────────┘
```

**涉及文件：**
- `src/stores/gameStateStore.ts` — ✅ 已实现 `GamePhase` 类型（`'hub' | 'mission' | 'settlement'`），包含 `setGamePhase()`、`hubState`、`currentMission` 等
- `src/views/GameView.vue` — ✅ 已根据阶段切换 UI 布局
- `src/router/index.ts` — ✅ 已新增副本相关路由（`/game/exchange`、`/game/team` 等）

### 2.2 存档结构改造 ✅ 已完成

当前存档以"单角色单世界"为核心。改造后需要支持：
- 主神空间的永久数据（角色属性、库存、积分、已完成副本记录）
- 副本临时数据（当前副本状态、进度、临时获取的物品/能力）
- 副本完成后的结算与合并

**涉及文件：**
- `src/types/game.d.ts` — ✅ 已改造，`SaveData` 包含 `轮回者/主神空间/团队/副本记录/当前副本`，保留旧 `角色` 字段做兼容
- `src/types/saveSchemaV3.ts` — ✅ 已改造为 `ReincarnatorStateV3` 结构
- `src/utils/saveMigration.ts` — ✅ 已覆盖 REQUIRED_V3_KEYS、轮回者/主神空间/团队/副本记录，使用 reincarnatorProgress 做等级/星级/灵魂结算

---

## 3. 世界系统改造

### 3.1 主神空间（新增核心场景） ✅ 已完成

主神空间是玩家在副本之间的**常驻据点**，功能包括：

| 功能区 | 描述 | 对应当前系统 |
|--------|------|------------|
| **兑换大厅** | 用神点兑换能力、物品、技能 | 无，需新建 |
| **训练场** | 测试/练习已获得的能力 | 部分复用修炼系统 |
| **信息终端** | 查看副本历史、排行榜、世界百科 | 部分复用记忆中心 |
| **社交区** | 与其他轮回者交流、组队、交易 | 复用联机穿越系统 |
| **休息区** | 恢复状态、整理装备 | 复用背包/装备系统 |
| **副本传送门** | 接受/选择下一个副本任务 | 无，需新建 |

**涉及文件（改造/新增）：**
- `src/components/dashboard/MainGamePanel.vue` — ✅ 已实现空间/副本模式切换（阶段横幅 + 模式专属操作按钮）
- `src/components/dashboard/HubMapPanel.vue` — ✅ 已新建
- `src/utils/worldGeneration/` — ✅ 已改造为副本世界生成逻辑（支持副本上下文注入）
- `src/data/creationData.ts` — ✅ 世界数据已改为无限流主题（主神空间、雾城封锁区、深海研究站等）

### 3.2 副本世界系统（替代原世界系统） ✅ 已完成

当前的"世界"概念（朝天大陆、地球、赛博修真等）改造为**副本世界模板**：

| 副本类型 | 示例 | 对应当前世界 |
|---------|------|------------|
| **修仙类** | 仙侠世界求生 | 朝天大陆 |
| **末日类** | 丧尸围城、核冬天 | 无，需新建 |
| **恐怖类** | 诡异空间、无限恐怖 | 诡异世界（可复用） |
| **科幻类** | 星际战争、赛博朋克 | 赛博修真/星海（可复用） |
| **奇幻类** | 魔法大陆、龙与地下城 | 魔法纪元（可复用） |
| **武侠类** | 江湖风云 | 武道苍穹（可复用） |
| **现代类** | 都市异能、谍战 | 地球（可复用） |
| **历史类** | 三国乱世、大航海时代 | 无，需新建 |

**关键设计：**
- 每个副本有独立的**世界规则**（力量体系、科技水平、社会结构）
- 副本有**主线任务**（必须完成）和**支线任务**（额外奖励）
- 副本有**难度等级**（D/C/B/A/S/SS/SSS）
- 副本有**时间限制**或**触发条件**

**涉及文件：**
- `src/data/creationData.ts` — ✅ `LOCAL_WORLDS` 已改造为无限流副本模板
- `src/utils/worldGeneration/enhancedWorldGenerator.ts` — ✅ 已改造：支持副本阶段/类型/难度上下文注入
- `src/utils/worldGeneration/enhancedWorldPrompts.ts` — ✅ 已改造：无限流副本语义 + 任务上下文提示
- `src/types/worldMap.ts` — ✅ 已存在（`WorldMapConfig` 已导出），副本地图数据走 `Mission.副本地图` 字段

### 3.3 地图系统改造 ✅ 核心链路已改造

当前地图系统（WorldMapRoute、GameMapPanel、RegionMapPanel）设计为**单一持久世界**。改造后：

- 主神空间地图：固定布局，功能区导航
- 副本世界地图：每次副本独立生成，副本结束后归档
- 地图数据不再持久化到主存档，而是存放在副本临时数据中

**涉及文件：**
- `src/components/dashboard/WorldMapRoute.vue` — ✅ 已改造：按 `gamePhase` 切换 hub 视图（HubMapPanel）与副本任务追踪视图（292 行）
- `src/components/dashboard/GameMapPanel.vue` — 保留原结构（2933 行），副本地图体验可继续打磨
- `src/components/dashboard/RegionMapPanel.vue` — 保留原结构
- `src/utils/gameMapManager.ts` — 保留原结构

---

## 4. 角色系统改造

### 4.1 角色创建流程改造 ✅ 已完成（极简版 v2）

无限流创角已简化为 **3 步**：

| 步骤 | 内容 | 对应组件 |
|------|------|--------|
| 1 | **金手指** — 选择 1 个，D级/未激活起步 | `Step2_GoldenFingerSelection.vue` |
| 2 | **基础属性** — 固定 30 点分配（六维） | `Step6_AttributeAllocation.vue` |
| 3 | **最终确认** — 预览、选填穿越前身份，进入主神空间 | `Step7_Preview.vue` |

**设计要点：**
- 移除：觉醒类型、穿越契机、天赋潜能、人物模版（独立步骤全部移除）
- 金手指：初期与玩家同级（D级/未激活），随副本完成可进阶，避免开局强度失衡
- 穿越前身份：确认页选填文本框，纯叙事用途，AI 根据描述动态赋予初始能力
- 初始技能：不再预设，由 AI 在进入副本时根据穿越前身份自然生成

> ⚠️ `Step1_TemplateSelection.vue` 虽已建文件但**未被任何页面引入**，属于死代码，后续可清理。

**涉及文件：**
- `src/data/infiniteCreationData.ts` — ✅ 金手指 8 个选项（100 行）、固定 30 点
- `src/components/character-creation/Step2_GoldenFingerSelection.vue` — ✅ 金手指选择
- `src/components/character-creation/Step6_AttributeAllocation.vue` — ✅ 六维属性分配
- `src/components/character-creation/Step7_Preview.vue` — ✅ 确认页含穿越前身份文本框
- `src/stores/characterCreationStore.ts` — ✅ `TOTAL_STEPS = 3`、payload 含 pre_reincarnation_identity
- `src/services/characterInitialization.ts` — ✅ 金手指写入轮回者、abilities 初始为空

### 4.2 属性系统改造 ✅ 类型与 UI 已适配，底层计算部分兼容

当前属性体系以修仙为核心（根骨/灵性/悟性/气运/魅力/心性 + 气血/灵气/神识）。改造为通用的无限流属性：

**基础六维属性（替代"先天六司"）：**

| 当前属性 | 改造为 | 说明 |
|---------|--------|------|
| 根骨 | **力量 (STR)** | 物理攻击、负重 |
| 灵性 | **感知 (PER)** | 观察力、第六感、危险预知 |
| 悟性 | **智力 (INT)** | 学习速度、策略能力、技能理解 |
| 气运 | **幸运 (LUK)** | 随机事件倾向、掉落概率 |
| 魅力 | **魅力 (CHA)** | 社交能力、NPC 好感度加成 |
| 心性 | **意志 (WIL)** | 精神抗性、恐惧抵抗、洗脑抵抗 |

**战斗属性（替代气血/灵气/神识）：**

| 当前属性 | 改造为 | 说明 |
|---------|--------|------|
| 气血 | **生命值 (HP)** | 通用 |
| 灵气 | **能量值 (EP)** | 通用能量（驱动技能/能力） |
| 神识 | **精神力 (MP)** | 精神类能力消耗 |

**涉及文件：**
- `src/types/game.d.ts` — ✅ `ReincarnatorProfile` 已定义 STR/PER/INT/LUK/CHA/WIL 和 HP/EP/MP；`PlayerStatus` 保留旧字段做兼容
- `src/utils/attributeCalculation.ts` — ⚠️ 存在 `CHINESE_TO_INFINITE_MAP` 等转换逻辑，主流程仍有修仙路径，新体系通过轮回者结构走
- `src/components/dashboard/CharacterDetailsPanel.vue` — ✅ 已适配：展示轮回者核心、六维属性、HP/EP/MP、能力与携带
- `src/components/character-creation/Step6_AttributeAllocation.vue` — ✅ 已适配：STR/PER/INT/LUK/CHA/WIL 六维，固定 30 点分配

### 4.3 境界系统 → 轮回者等级系统 ✅ 已实现

当前的修仙境界体系（凡人→练气→...→渡劫）改造为**轮回者等级**：

| 当前境界 | 改造等级 | 说明 |
|---------|---------|------|
| 凡人 | **新人 (D级)** | 刚进入主神空间 |
| 练气 | **初级轮回者 (C级)** | 完成 1-3 个副本 |
| 筑基 | **中级轮回者 (B级)** | 有稳定的能力体系 |
| 金丹 | **高级轮回者 (A级)** | 实力强劲，副本核心成员 |
| 元婴 | **精英轮回者 (S级)** | 副本中的王者 |
| 化神 | **传说轮回者 (SS级)** | 接近主神空间的秘密 |
| 炼虚+ | **超越者 (SSS级)** | 有资格挑战主神 |

#### 4.3.1 核心成长资源：灵魂强度

灵魂强度是轮回者的**核心成长指标**，代表灵魂在副本生死淬炼中被强化的程度。

**设计原则：**
- 灵魂强度是**被动积累**的，不能在主神空间主动修炼，只在副本中增长
- 灵魂强度**不是每回合实时变化**的，而是**每次副本结束时一次性结算**
- 数值计算完全由**前端逻辑**负责，不依赖 AI 判断，确保一致性

**副本结算公式：**

```
本次灵魂增长 = 基础值 × 难度系数 × 评价系数 × 特殊事件加成

├── 基础值：由副本难度等级决定（D级副本基础10，C级30，B级80...）
├── 难度系数：1.0（普通通关）/ 0.3（勉强通关）/ 1.5（完美通关）/ 0.1（副本失败但存活）
├── 评价系数：根据副本评分（完成度、用时、队友存活率等综合计算）
└── 特殊事件加成：副本过程中 AI 标记的关键事件折算的加成乘数
```

**AI 在灵魂增长中的角色：**

AI 在副本过程中**不负责计算灵魂强度**，只负责**标记特殊事件**。这些标记在副本结算时被前端读取，折算为加成系数：

```json
{
  "action": "push",
  "key": "当前副本.特殊事件标记",
  "value": {
    "type": "near_death",
    "description": "HP降至3%后反杀Boss",
    "weight": 1.5
  }
}
```

特殊事件类型及权重参考：

| 事件类型 | 触发条件 | 加成权重 |
|---------|---------|---------|
| 濒死体验 | HP 降至 10% 以下后存活 | ×1.3 ~ ×1.5 |
| 关键抉择 | 面临重大道德/策略困境时做出选择 | ×1.1 ~ ×1.3 |
| 队友死亡 | 永久失去同伴 | ×1.2 |
| 能力突破 | 首次将某能力推至极限使用 | ×1.1 |
| 隐藏任务 | 完成副本隐藏目标 | ×1.3 ~ ×1.5 |

#### 4.3.2 星级子阶段（灵魂强度的可视化刻度）

星级是灵魂强度这个连续数值的**显示层**，不是独立的突破机制。灵魂强度到了对应阈值，星级自动变化。

| 子阶段 | 含义 | 灵魂强度占比 |
|--------|------|-------------|
| ★☆☆☆☆（一星） | 刚晋升，适应新等级 | 0-20% |
| ★★☆☆☆（二星） | 开始稳定掌控 | 20-45% |
| ★★★☆☆（三星） | 战斗力成熟 | 45-70% |
| ★★★★☆（四星） | 当前等级巅峰，满足晋升灵魂条件 | 70-95% |
| ★★★★★（五星） | 超越常规，晋升试炼更轻松 | 95-100% |

**关键特性：**
- 星级只是灵魂强度的"刻度读数"，**不存在星级突破的概念**
- 一次高难度副本回来可能直接从一星跳到三星（灵魂增长量大）
- 也可能一次低收益副本只在同一星内小幅移动
- 完整的等级表述示例：**A级三星轮回者**、**S级五星轮回者**

以 C 级为例的灵魂强度-星级对照：

```
C 级灵魂强度范围：100 ~ 500

  ★☆☆☆☆  100 - 179
  ★★☆☆☆  180 - 269
  ★★★☆☆  270 - 369
  ★★★★☆  370 - 459    ← 满足晋升灵魂条件
  ★★★★★  460 - 500    ← 晋升试炼更轻松
```

#### 4.3.3 晋升机制：条件达标 + 主神强制触发

**晋升前置条件（缺一不可）：**

| 条件 | 说明 |
|------|------|
| 灵魂强度 | 达到当前等级四星以上（五星更佳） |
| 最低副本数 | 累计完成 N 个当前难度或更高难度的副本 |
| 晋升资格点 | 用副本评分积分兑换（防止灵魂够了但积累不足） |

**各等级晋升条件：**

| 晋升 | 灵魂强度要求 | 最低副本数 | 资格点 |
|------|------------|-----------|--------|
| D → C | D级四星 | 2 个 D 级 | 500 |
| C → B | C级四星 | 3 个 C 级 | 2000 |
| B → A | B级四星 | 4 个 B 级 | 8000 |
| A → S | A级四星 | 5 个 A 级 | 30000 |
| S → SS | S级四星 | 6 个 S 级 | 100000 |
| SS → SSS | SS级四星 | 8 个 SS 级 | ？？？ |

> 从 D 到 SSS 约需 28 个副本（不含失败重来），实际游玩量约 30-40 个。体验到 A/S 级约 15-20 个副本。

**触发方式：**

三个条件全部满足后，**主神在下一次副本传送时强制触发晋升试炼**，玩家无法选择时机。这是无限流的核心设计——主神才是规则制定者，玩家能做的是在条件满足前尽量做好准备。

**晋升成功：** 等级提升，灵魂强度重置到新等级一星起点，解锁更高难度副本和兑换项。

**晋升失败：** 灵魂强度回退 30%，需重新积累才能再次触发。连续失败 3 次永久降低灵魂强度上限（等于变相判死刑——早晚跟不上副本难度曲线）。

#### 4.3.4 晋升试炼设计

晋升试炼是纯个人挑战（队友无法参与），每个等级考验不同的核心维度：

| 晋升 | 试炼名称 | 考验维度 | 试炼形式 |
|------|---------|---------|---------|
| D→C | **生存证明** | 求生本能 | 独自在高危环境中存活指定时间（无队友、资源有限） |
| C→B | **心志试炼** | 精神韧性 | 面对幻境/精神攻击，在绝望情境中保持理智并找到出路 |
| B→A | **决断试炼** | 策略与抉择 | 多方博弈场景，在不完美信息下做出关键抉择 |
| A→S | **极限战斗** | 战斗极限 | 对抗针对玩家能力设计的敌人，逼迫突破上限 |
| S→SS | **真相试炼** | 认知与本心 | 揭示部分主神空间真相，考验在真相冲击下坚守自我 |
| SS→SSS | **???** | 未知 | 后期内容，暂不设计 |

**试炼规则：**

- **全装备全能力可携带**：已获得的东西不做限制
- **针对短板设计**：试炼内容由 AI 根据玩家的能力和经历动态生成，专门避开玩家的舒适区（擅长远程→密闭空间、擅长社交→无对话对象、精神强体力弱→体能极限考验）
- **试炼内容不是固定模板**：利用项目的 AI 驱动优势，每次生成针对性考验

**涉及文件：**
- `src/data/realms.ts` — ✅ 已改造：RANK_LABELS（D-SSS）、LEGACY_REALM_TO_LEVEL、buildRealmDefinitions 为无限流等级
- `src/utils/realmUtils.ts` — ✅ 已改造：兼容轮回者等级与旧境界，`formatRealmWithStage` 支持 D-SSS + 星级
- `src/utils/cultivationSpeedCalculator.ts` — ✅ 已改造：引入 `calculateSoulGrowth`，副本结算灵魂成长逻辑就位
- `src/utils/reincarnatorProgress.ts` — ✅ 已新建：RANK_SOUL_RANGES、PROMOTION_REQUIREMENTS、getStarFromSoulStrength、canTriggerPromotionTrial 等

---

## 5. 副本任务系统（新增） ✅ 已完成

~~这是改造的**核心新增系统**，当前项目没有对应模块。~~ 已全部实现。

### 5.1 副本生命周期

```
副本选择/分配 → 副本简报 → 传送进入 → 副本进行中 → 任务完成/失败 → 结算界面 → 返回主神空间
```

### 5.2 副本数据结构（新增）

```typescript
interface Mission {
  id: string;
  name: string;                    // 副本名称
  worldType: MissionWorldType;     // 世界类型（修仙/末日/恐怖/科幻/奇幻...）
  difficulty: MissionDifficulty;   // 难度等级 D-SSS
  description: string;             // 副本背景描述
  worldRules: WorldRules;          // 该世界的力量规则
  mainQuest: Quest;                // 主线任务
  sideQuests: Quest[];             // 支线任务
  timeLimit?: number;              // 时间限制（副本内天数）
  survivalCondition: string;       // 存活条件
  rewards: MissionRewards;         // 基础奖励
  penalties: MissionPenalties;     // 失败惩罚
  participants: Participant[];     // 参与者（轮回者+原住民）
  status: 'briefing' | 'active' | 'completed' | 'failed';
}

interface Quest {
  id: string;
  title: string;
  description: string;
  objectives: QuestObjective[];    // 目标列表
  reward: QuestReward;
  isHidden: boolean;               // 是否为隐藏任务
}

interface MissionRewards {
  basePoints: number;              // 基础神点
  bonusPoints: number;             // 额外奖励
  items: Item[];                   // 奖励物品
  abilities: Ability[];            // 可获得的能力
  evaluationBonus: number;         // 评价加成
}
```

### 5.3 副本生成（AI 驱动）

利用现有的 AI 服务，在副本开始时由 AI 生成：
- 世界背景和规则
- 主线/支线任务
- 关键 NPC
- 地图概览
- 危险等级描述

**涉及文件（全部已建）：**
- `src/utils/missionGeneration/missionGenerator.ts` — ✅ 已实现（92 行）
- `src/utils/missionGeneration/missionPrompts.ts` — ✅ 已实现（50 行）
- `src/utils/missionGeneration/missionValidator.ts` — ✅ 已实现（151 行）
- `src/stores/missionStore.ts` — ✅ 已实现（162 行）
- `src/types/mission.ts` — ✅ 已实现（193 行，定义 `Mission`/`MissionResult`/`TeamState` 等接口）
- `src/data/missionTemplates.ts` — ✅ 已实现（75 行，4 个预设副本模板 D/C/B/A）
- `src/components/dashboard/MissionSelectPanel.vue` — ✅ 已实现（321 行）
- `src/components/dashboard/MissionBriefingPanel.vue` — ✅ 已实现（158 行）
- `src/components/dashboard/MissionSettlementPanel.vue` — ✅ 已实现（243 行）
- `src/components/dashboard/MissionHistoryPanel.vue` — ✅ 已实现（121 行）

---

## 6. 经济与积分系统 ✅ 已完成

### 6.1 货币系统改造

| 当前 | 改造后 | 说明 |
|------|--------|------|
| 灵石（下/中/上/极品） | **神点 (God Points)** | 主要通用货币，副本奖励获得 |
| 铜币/银两/金锭 | **副本临时货币** | 仅在副本内有效 |
| 无 | **贡献点** | 团队副本中的个人贡献 |

### 6.2 兑换系统（新增，替代坊市/交易）

主神空间的核心功能 — 用神点兑换一切：

| 兑换类别 | 示例 |
|---------|------|
| **能力** | 战斗技能、被动天赋、体质强化 |
| **物品** | 武器、防具、消耗品、特殊道具 |
| **信息** | 副本预知、世界情报、能力图鉴 |
| **服务** | 治疗、属性重置、装备强化 |
| **特殊** | 复活币、逃脱令、时间延长 |

**涉及文件：**
- `src/utils/currencySystem.ts` — ✅ 已改造，主货币为神点（`DEFAULT_BASE_CURRENCY_ID = '神点'`），灵石标记为旧体系兼容货币
- `src/components/dashboard/InventoryPanel.vue` — ✅ 已适配：神点为主货币、可带入副本、副本临时仓库
- `src/components/dashboard/ExchangePanel.vue` — ✅ 已实现，支持神点购买、分类浏览

---

## 7. 成长与能力系统 ⚠️ 大部分完成（UI 与底层数据已统一，craftingSystem 未通用化）

### 7.1 功法系统 → 能力系统

当前的功法/技能体系（与修仙紧密绑定）需要改造为**通用能力系统**：

| 当前概念 | 改造后 | 说明 |
|---------|--------|------|
| 功法 | **能力 (Ability)** | 可携带进副本的永久能力 |
| 技能 | **技能 (Skill)** | 能力衍生的具体招式 |
| 三千大道 | **能力树 (Skill Tree)** | 多条成长路线 |
| 炼制/炼丹 | **制作系统** | 保留但通用化 |

### 7.2 能力分类

```
能力类型
├── 战斗类 — 近战/远程/法术/召唤
├── 辅助类 — 治疗/强化/结界/侦查
├── 生存类 — 隐匿/逃脱/伪装/适应
├── 社交类 — 读心/魅惑/威慑/谈判
├── 特殊类 — 时空/命运/规则干涉
└── 世界特有 — 仅在特定类型副本生效的能力
```

### 7.3 能力来源

- **神点兑换**：在主神空间花费神点购买
- **副本奖励**：完成任务获得
- **副本内习得**：在副本中学习该世界的力量（如修仙世界学会御剑术）
- **强化/进化**：已有能力升级

**涉及文件：**
- `src/components/dashboard/SkillsPanel.vue` — ✅ 已改造为"能力管理"面板（标题/功能已替换为能力体系）
- `src/components/dashboard/ThousandDaoPanel.vue` — ✅ 已改造为"能力树总览"面板（显示能力分支、神点兑换）
- `src/components/dashboard/AbilityTreePanel.vue` — ✅ 已新建
- `src/data/thousandDaoData.ts` — ✅ 已改造为无限流能力树底层（分支/节点/前置依赖/统一数据源，268 行）
- `src/utils/craftingSystem.ts` — ⚠️ **未通用化**，仍为修仙炼丹/炼器体系（`CraftingType = '炼丹' | '炼器'`），后续需替换为通用制作系统

---

## 8. NPC 与社交系统 ✅ 已完成

### 8.1 NPC 分类改造

| NPC 类型 | 说明 | 持久性 |
|---------|------|--------|
| **主神** | 神秘存在，发布任务，规则制定者 | 永久 |
| **轮回者同伴** | 其他被拉入主神空间的人 | 永久（可死亡） |
| **空间商人** | 主神空间内的 NPC 商人 | 永久 |
| **副本原住民** | 副本世界中的 NPC | 临时（副本结束消失） |
| **副本 Boss** | 副本中的关键敌人 | 临时 |

### 8.2 队伍系统（新增）

无限流的核心要素 — 轮回者团队：

- 玩家可以组建/加入**团队**
- 团队成员在副本中可以协作或背叛
- 队友有独立的性格、能力和动机
- 老队友可能在副本中死亡（永久）

### 8.3 社交系统改造

当前的关系网络系统（RelationshipNetworkPanel）可以大量复用，但需要增加：
- 队友忠诚度/信任度
- 敌对轮回者的仇恨系统
- 副本内临时关系追踪

**涉及文件：**
- `src/components/dashboard/RelationshipNetworkPanel.vue` — ✅ 已适配无限流（5085 行），支持轮回评级+星级显示、无限流叙述风格摘要、主神空间人物世界书
- `src/components/dashboard/TeamPanel.vue` — ✅ 已实现（287 行），支持队友管理、信任度、团队事件
- `src/stores/teamStore.ts` — ✅ 已实现（47 行）
- `src/types/game.d.ts` — ✅ NPCData 类型已扩展
- `src/types/mission.ts` — ✅ 定义了 `TeamMember`/`TeamState`/`TeamCollaborationLog`/`TeamEventLog`
- `src/data/specialNpcs.ts` — ✅ 已改造为空间常驻 NPC 池（医疗/交易/调度/后勤等）

---

## 9. AI Prompt 系统改造 ✅ 已完成

~~这是改造的**重中之重**。当前整套 prompt 都是为修仙世界观定制的，需要全面重构。~~ 已全部完成。

### 9.1 核心规则改造

| Prompt 文件 | 改造内容 | 状态 |
|------------|---------|------|
| `coreRules.ts` | JSON 输出格式基本保留，数据路径适配新结构 | ✅ 已适配 |
| `businessRules.ts` | **全部重写** — 境界体系→等级体系；修仙规则→无限流规则 | ✅ 已重写（主神空间无限流业务规则） |
| `dataDefinitions.ts` | **全部重写** — 存档数据结构重新定义 | ✅ 已重写（主神空间无限流 SaveData 结构） |
| `textFormats.ts` | 部分调整 — 去除修仙特有格式，增加副本叙事格式 | ✅ 已适配 |
| `worldStandards.ts` | **全部重写** — 境界属性标准→等级属性标准；势力体系→副本难度体系 | ✅ 已重写（主神空间无限流世界标准数值） |
| `actionOptions.ts` | 部分调整 — 行动选项区分空间/副本两种上下文 | ✅ 已适配 |
| `eventSystemRules.ts` | **大幅改造** — 事件系统改为副本内事件+空间事件 | ✅ 已重写（主神空间无限流事件系统规范） |
| `playerPersonality.ts` | 部分调整 — 去除修仙特有性格描述 | ✅ 已适配 |

### 9.2 新增 Prompt 模块

| 新模块 | 用途 | 状态 |
|--------|------|------|
| `missionBriefingPrompts.ts` | 副本简报生成 | ✅ 已实现（82 行） |
| `missionNarrativePrompts.ts` | 副本叙事规则 | ✅ 已实现（119 行） |
| `missionSettlementPrompts.ts` | 副本结算生成 | ✅ 已实现（128 行） |
| `hubNarrativePrompts.ts` | 主神空间叙事规则 | ✅ 已实现（96 行） |
| `worldAdaptationRules.ts` | AI 如何适配不同世界类型的规则 | ✅ 已实现（135 行） |

**promptAssembler**：✅ 已支持空间/副本双模式（190 行），按 `resolveGamePhase(gameState)` 自动注入 `hubNarrativePrompts` / `missionNarrativePrompts` / `missionSettlementPrompts`，`defaultPrompts.ts`（819 行）已注册全部 5 个新模块。

### 9.3 关键规则变更

**当前核心规则（修仙向）：**
- 境界碾压不可逆
- 功法/灵根/丹药体系
- 修仙特有的时间感（百年闭关等）
- 宗门/势力体系

**改造后核心规则（无限流向）：**
- 副本难度与玩家等级匹配
- 能力使用有限制（能量值/冷却）
- 副本任务驱动叙事
- 信息差是核心策略（知道副本剧情 = 优势）
- 队友信任与背叛博弈
- 生存压力始终存在
- 不同世界有不同力量规则（修仙世界可以用灵气，科幻世界用科技）

**涉及文件：**
- `src/utils/prompts/definitions/` — ✅ 核心 4 个文件已重写（businessRules/dataDefinitions/worldStandards/eventSystemRules）
- `src/utils/prompts/promptAssembler.ts` — ✅ 已支持空间/副本双模式，按阶段注入 phasePromptKeys
- `src/services/defaultPrompts.ts` — ✅ 已注册 worldAdaptationRules、hubNarrativePrompts、missionBriefingPrompts、missionNarrativePrompts、missionSettlementPrompts

---

## 10. UI/UX 改造 ✅ 已完成

### 10.1 主界面布局

当前的三栏布局（左侧导航 + 中间游戏面板 + 右侧信息）可以保留，但内容需要区分两种模式：

**主神空间模式：**
- 左侧：空间功能导航（兑换/训练/社交/信息/任务）
- 中间：空间交互面板
- 右侧：角色信息/库存

**副本模式：**
- 左侧：任务进度/地图/队友状态
- 中间：副本叙事面板（保留当前对话式交互）
- 右侧：角色状态/技能/物品

### 10.2 需要新增的 UI 组件 ✅ 全部已建

| 组件 | 说明 | 状态 |
|------|------|------|
| `MissionSelectPanel.vue` | 副本选择/分配界面 | ✅ 321 行 |
| `MissionBriefingPanel.vue` | 副本简报（进入前） | ✅ 158 行 |
| `MissionSettlementPanel.vue` | 副本结算（完成后） | ✅ 243 行 |
| `ExchangePanel.vue` | 神点兑换商店 | ✅ 144 行 |
| `TeamPanel.vue` | 队伍管理面板 | ✅ 287 行 |
| `AbilityTreePanel.vue` | 能力树面板（替代三千大道） | ✅ 183 行 |
| `MissionHistoryPanel.vue` | 已完成副本记录 | ✅ 121 行 |
| `HubMapPanel.vue` | 主神空间地图 | ✅ 113 行 |

### 10.3 需要改造的现有组件

| 组件 | 改造内容 | 状态 |
|------|---------|------|
| `MainGamePanel.vue` | 区分空间/副本两种叙事模式 | ✅ 已实现（阶段横幅 + 模式按钮） |
| `CharacterDetailsPanel.vue` | 属性体系替换 | ✅ 已改造（轮回者核心、六维、HP/EP/MP、当前副本状态） |
| `InventoryPanel.vue` | 增加"可携带进副本"标记 | ✅ 已改造（神点为主货币、可带入副本勾选、副本临时仓库） |
| `SkillsPanel.vue` | 改为能力管理 | ✅ 已改造 |
| `SettingsPanel.vue` | 增加副本相关设置 | ✅ 主题含「主神」选项，基础设置已适配 |
| `LeftSidebar.vue` | 导航项改造 | ✅ 已添加兑换/队伍等导航项 |
| `RightSidebar.vue` | 信息面板改造 | ✅ 已改造（轮回面板、等级/灵魂强度/神点/HP/EP/MP） |
| `TopBar.vue` | 增加当前状态指示（空间/副本） | ✅ 已改造（主神空间标题、phase-badge、formatStarText 等级显示） |

---

## 11. 数据结构改造（types/存档） ✅ 已完成（保留旧字段做兼容）

### 11.1 顶层存档结构

当前存档结构（`game.d.ts`）：
```
SaveData
├── 元数据（版本、时间）
├── 角色（身份、属性、境界、灵根、功法、装备、背包）
├── 社交（关系、事件）
├── 世界（地图数据）
└── 系统（配置）
```

改造后：
```
SaveData
├── 元数据（版本、时间、当前阶段）
├── 轮回者（身份、基础属性、等级、永久能力、神点、装备、背包）
├── 主神空间（商店状态、解锁区域、常驻NPC关系）
├── 团队（成员列表、信任度、共享物资）
├── 副本记录（已完成副本列表、评价、统计）
├── 当前副本（仅副本进行中有值）
│   ├── 副本信息（世界类型、任务、时间）
│   ├── 临时状态（副本内属性加成、临时物品、进度）
│   ├── 副本NPC（临时关系网）
│   └── 副本地图
└── 系统（配置、AI设置）
```

### 11.2 关键类型定义变更

需要新增/替换的核心 interface：

```typescript
// 轮回者（替代 PlayerStatus）
interface Reincarnator {
  identity: ReincarnatorIdentity;     // 身份信息
  level: ReincarnatorLevel;           // 等级（D-SSS）
  attributes: BaseAttributes;         // 六维属性
  vitals: VitalStats;                 // HP/EP/MP
  abilities: Ability[];               // 已获得的能力
  equipment: Equipment;               // 装备
  inventory: Inventory;               // 背包
  godPoints: number;                  // 神点
  missionCount: number;               // 完成副本数
  survivalRate: number;               // 存活率
}

// 副本（新增）
interface Mission { ... }            // 见第5节

// 主神空间状态（新增）
interface HubState {
  unlockedAreas: string[];            // 已解锁区域
  shopInventory: ShopItem[];          // 商店库存
  availableMissions: Mission[];       // 可选副本
  npcs: HubNPC[];                     // 常驻NPC
}

// 团队（新增）
interface Team {
  members: TeamMember[];
  sharedResources: Item[];
  teamLevel: number;
}
```

---

## 12. 技术复用评估

### 12.1 可以大量复用的模块 ✅

| 模块 | 复用度 | 说明 |
|------|--------|------|
| AI 服务层 (`aiService.ts`) | 90% | API 调用逻辑不变，只改 prompt |
| 向量记忆 (`vectorMemoryService.ts`) | 80% | 记忆机制可直接复用 |
| IndexedDB 管理 (`indexedDBManager.ts`) | 95% | 存储层完全复用 |
| 存档管理 (`SavePanel.vue`) | 70% | 保存/加载逻辑复用，数据结构改 |
| 骰子系统 (`diceRoller.ts`) | 100% | 判定机制通用 |
| Toast/通知系统 | 100% | 完全复用 |
| 主题系统 | 100% | 完全复用 |
| 设置面板 | 80% | 基础设置复用 |
| API 管理 | 95% | AI 配置完全复用 |
| SillyTavern 集成 | 90% | 嵌入模式复用 |
| CI/CD 流水线 | 100% | 完全复用 |
| Docker 部署 | 100% | 完全复用 |
| JSON 提取 (`jsonExtract.ts`) | 100% | 完全复用 |
| CoT 系统 (`cotCore.ts`) | 80% | 思维链逻辑复用，prompt 改 |
| 双向通信 (`AIBidirectionalSystem.ts`) | 70% | 指令系统复用，路径改 |

### 12.2 需要大幅改造的模块 ⚠️

| 模块 | 复用度 | 说明 |
|------|--------|------|
| Prompt 体系 | 20% | 架构复用，内容全改 |
| 角色创建 | 30% | UI 框架复用，内容全改 |
| 属性计算 | 30% | 计算逻辑复用，公式全改 |
| 世界生成 | 20% | 架构参考，逻辑重写 |
| 地图系统 | 30% | 组件框架复用，逻辑重写 |
| 游戏状态管理 | 40% | 状态管理模式复用，内容改 |
| 类型定义 (`game.d.ts`) | 20% | 通用接口保留，业务类型全改 |

### 12.3 需要全新开发的模块 🆕

| 模块 | 工作量 | 说明 |
|------|--------|------|
| 副本系统 | 大 | 核心新功能 |
| 兑换系统 | 中 | 神点商店 |
| 团队系统 | 中 | 轮回者组队 |
| 副本结算 | 中 | 结算逻辑 + UI |
| 主神空间场景 | 中 | 空间交互 |
| 能力树系统 | 中 | 替代三千大道 |

---

## 13. 改造优先级与里程碑

### Phase 0: 基础准备 ✅ 已完成
- [x] 确定最终设计方案（本文档讨论定稿）
- [ ] 新建分支 `feature/infinite-stream`（当前在 master 直接开发）
- [x] 设计新数据结构（types）— `game.d.ts`/`saveSchemaV3.ts`/`mission.ts`/`reincarnator.ts` 已建
- [x] 设计存档迁移方案 — `saveMigration.ts` 已覆盖新旧结构转换，使用 reincarnatorProgress

### Phase 1: 核心骨架 ✅ 已完成
- [x] 实现游戏状态机（主神空间 ↔ 副本）— `GamePhase: 'hub' | 'mission' | 'settlement'`
- [x] 改造角色创建流程 — 3 步流程（金手指→属性→预览），CharacterCreation 已接入
- [x] 改造属性/等级系统 — `realms.ts`/`realmUtils.ts`/`reincarnatorProgress.ts`/`cultivationSpeedCalculator.ts` 已改造
- [x] 实现主神空间基础场景 — HubMapPanel + MainGamePanel 空间模式
- [x] 实现副本生成骨架 — missionGenerator + missionValidator + missionPrompts

### Phase 2: 副本系统 ✅ 已完成
- [x] 实现副本生命周期（简报→进行→结算）— 三个面板全部就位
- [x] 改造 AI Prompt 体系（核心规则）— 4 个核心文件已重写 + 4 个新增模块
- [x] 实现副本内叙事交互 — MainGamePanel 副本模式
- [x] 实现任务追踪系统 — missionStore
- [x] 实现副本结算逻辑 — MissionSettlementPanel + applyMissionSettlement()

### Phase 3: 成长与经济 ⚠️ 大部分完成（craftingSystem 遗留）
- [x] 实现神点经济系统 — currencySystem.ts 已改造，神点为主货币
- [x] 实现兑换商店 — ExchangePanel.vue
- [x] 实现能力系统（替代功法）— SkillsPanel 已改造为能力管理
- [x] 实现能力树（替代三千大道）— ThousandDaoPanel 已改造 + AbilityTreePanel 新建
- [x] **改造底层数据** — ✅ `thousandDaoData.ts` 已切换为无限流能力树数据结构
- [ ] **通用化制作系统** — ❌ `craftingSystem.ts` 仍为炼丹/炼器，需替换

### Phase 4: 社交与团队 ✅ 已完成
- [x] 实现轮回者队友系统 — TeamPanel + teamStore
- [x] **改造 NPC 数据** — ✅ `specialNpcs.ts` 已切换为主神空间常驻 NPC 模板
- [x] 实现队伍管理 — 队友增删、信任度、团队事件
- [x] 关系网络 — ✅ RelationshipNetworkPanel 已适配无限流（轮回评级/星级显示、主神空间人物世界书）

### Phase 5: 打磨与扩展 ❌ 未开始
- [ ] UI 全面调整与美化
- [ ] 副本模板丰富化
- [ ] 平衡性调优
- [ ] 存档迁移测试
- [ ] 文档更新

---

### 遗留问题清单（需优先处理）

以下是已识别的**未改造残留项**。等级/灵魂/属性体系已就位，核心残留已基本清空，当前以体验优化为主：

| 优先级 | 文件 | 问题 | 影响 |
|--------|------|------|------|
| ~~🔴 高~~ | ~~`src/data/realms.ts`~~ | ~~仍为修仙境界定义~~ | ✅ 已改造为 D-SSS 轮回者等级 |
| ~~🔴 高~~ | ~~`src/utils/realmUtils.ts`~~ | ~~仍为修仙境界工具函数~~ | ✅ 已兼容轮回者等级与星级 |
| ~~🔴 高~~ | ~~`src/utils/cultivationSpeedCalculator.ts`~~ | ~~仍为修炼速度计算~~ | ✅ 已引入 calculateSoulGrowth |
| 🟡 中 | `src/utils/craftingSystem.ts` | 仍为修仙炼丹/炼器体系（`'炼丹' | '炼器'`） | 无限流场景下需替换为通用制作系统 |
| 🟢 低 | `src/utils/attributeCalculation.ts` | 兼容路径保留较多旧字段（`CHINESE_TO_INFINITE_MAP`） | 已补充轮回者属性回退，后续可继续清理 |
| 🟢 低 | `src/components/dashboard/WorldMapRoute.vue` | 副本地图体验仍可继续打磨 | hub/mission 分流已完成（292 行） |
| 🟢 低 | `src/components/character-creation/Step1_TemplateSelection.vue` | 死代码：已建文件但**未被任何页面引入**，数据源也不存在 | 可直接删除 |
| ~~🟢 低~~ | ~~新增 Prompt 模块（5 个）~~ | ~~内容为精简骨架~~ | ✅ 已扩充至 560 行（82-135 行/文件） |
| ~~🟡 中~~ | ~~`src/stores/characterCreationStore.ts`~~ | ~~混合新旧字段~~ | ✅ 3 步无限流流程已稳定（`TOTAL_STEPS = 3`） |
| ~~🟢 低~~ | ~~`src/components/character-creation/Step4_SpiritRootSelection.vue`~~ | ~~仍为灵根选择~~ | 无限流创角已跳过 Step4，仅联机/旧流程使用 |

---

## 附录 A：经典无限流参考作品

理解这些作品有助于把握改造方向：

| 作品 | 核心特点 | 可借鉴元素 |
|------|---------|-----------|
| 《无限恐怖》 | 开山之作，主神空间+电影副本 | 主神空间设计、团队机制、基因锁 |
| 《全球高武》 | 现代+异世界副本 | 等级评定体系、副本难度分级 |
| 《诡秘之主》 | 序列体系+非凡能力 | 能力获取机制、信息差博弈 |
| 《轮回乐园》 | 动漫副本+契约者 | 副本多样性、评分系统 |
| 《我有一座恐怖屋》 | 恐怖副本+解谜 | 恐怖类副本设计、氛围营造 |
| 《全能游戏设计师》 | 游戏规则设计 | 规则一致性、平衡性考量 |

## 附录 B：文件改动清单速查（含完成状态）

```
[全新开发] — ✅ 全部已建
  ✅ src/stores/missionStore.ts — 162 行
  ✅ src/stores/teamStore.ts — 47 行
  ✅ src/types/mission.ts — 193 行
  ✅ src/types/reincarnator.ts — 58 行
  ✅ src/utils/reincarnatorProgress.ts — 174 行，灵魂强度/等级/晋升/星级计算
  ✅ src/utils/missionGeneration/missionGenerator.ts — 92 行
  ✅ src/utils/missionGeneration/missionPrompts.ts — 50 行
  ✅ src/utils/missionGeneration/missionValidator.ts — 151 行
  ✅ src/data/missionTemplates.ts — 75 行，4 个预设副本模板（D/C/B/A 难度各一）
  ✅ src/utils/prompts/definitions/missionBriefingPrompts.ts — 82 行
  ✅ src/utils/prompts/definitions/missionNarrativePrompts.ts — 119 行
  ✅ src/utils/prompts/definitions/missionSettlementPrompts.ts — 128 行
  ✅ src/utils/prompts/definitions/hubNarrativePrompts.ts — 96 行
  ✅ src/utils/prompts/definitions/worldAdaptationRules.ts — 135 行
  ✅ src/components/dashboard/MissionSelectPanel.vue — 321 行
  ✅ src/components/dashboard/MissionBriefingPanel.vue — 158 行
  ✅ src/components/dashboard/MissionSettlementPanel.vue — 243 行
  ✅ src/components/dashboard/ExchangePanel.vue — 144 行
  ✅ src/components/dashboard/TeamPanel.vue — 287 行
  ✅ src/components/dashboard/AbilityTreePanel.vue — 183 行
  ✅ src/components/dashboard/MissionHistoryPanel.vue — 121 行
  ✅ src/components/dashboard/HubMapPanel.vue — 113 行

[大幅改造]
  ✅ src/types/game.d.ts — 已改造（保留旧字段兼容）
  ✅ src/types/saveSchemaV3.ts — 已改造
  ✅ src/stores/gameStateStore.ts — 已改造
  ✅ src/stores/characterCreationStore.ts — 3 步无限流流程已稳定（TOTAL_STEPS = 3）
  ✅ src/data/creationData.ts — 已改造
  ✅ src/data/realms.ts — 已改造（D-SSS 轮回者等级）
  ✅ src/data/thousandDaoData.ts — 已改造为能力树底层统一数据
  ✅ src/data/specialNpcs.ts — 已改造为空间常驻NPC模板
  ✅ src/utils/prompts/definitions/businessRules.ts — 已重写
  ✅ src/utils/prompts/definitions/dataDefinitions.ts — 已重写
  ✅ src/utils/prompts/definitions/worldStandards.ts — 已重写
  ✅ src/utils/prompts/definitions/eventSystemRules.ts — 已重写
  ✅ src/utils/prompts/promptAssembler.ts — 已支持空间/副本双模式
  ✅ src/utils/worldGeneration/enhancedWorldGenerator.ts — 已改造（支持副本上下文）
  ✅ src/utils/worldGeneration/enhancedWorldPrompts.ts — 已改造（无限流副本语义）
  ⚠️ src/utils/attributeCalculation.ts — 有转换逻辑（CHINESE_TO_INFINITE_MAP），主流程仍有旧路径（338 行）
  ⚠️ src/utils/craftingSystem.ts — 未通用化，仍为炼丹/炼器
  ✅ src/utils/cultivationSpeedCalculator.ts — 已改造（引入 calculateSoulGrowth，351 行）
  ✅ src/utils/currencySystem.ts — 已改造（220 行）
  ✅ src/utils/saveMigration.ts — 已覆盖新旧转换（737 行）
  ✅ src/services/characterInitialization.ts — 金手指已写入轮回者
  ✅ src/components/character-creation/Step2_GoldenFinger、Step6_Attribute、Step7_Preview — 3 步流程
  ⚠️ src/components/character-creation/Step1_TemplateSelection.vue — 死代码，未被引入
  ✅ src/components/dashboard/MainGamePanel.vue — 已改造
  ✅ src/components/dashboard/CharacterDetailsPanel.vue — 已改造（轮回者/六维/HP-EP-MP）
  ✅ src/components/dashboard/SkillsPanel.vue — 已改造
  ✅ src/components/dashboard/ThousandDaoPanel.vue — 已改造
  ✅ src/components/dashboard/InventoryPanel.vue — 已改造（神点/可带入副本/临时仓库）
  ✅ src/components/dashboard/WorldMapRoute.vue — 已改造（hub/mission 分流，292 行）
  ✅ src/components/dashboard/LeftSidebar.vue — 已改造
  ✅ src/components/dashboard/RightSidebar.vue — 已改造（轮回面板）
  ✅ src/components/dashboard/TopBar.vue — 已改造（主神空间/phase/等级）
  ✅ src/views/GameView.vue — 已接入阶段切换

[小幅调整]
  ✅ src/utils/prompts/definitions/coreRules.ts — 已适配
  ✅ src/utils/prompts/definitions/textFormats.ts — 已适配
  ✅ src/utils/prompts/definitions/actionOptions.ts — 已适配
  ✅ src/utils/prompts/definitions/playerPersonality.ts — 已适配
  ✅ src/router/index.ts — 已添加新路由

[完全复用] — 无需改动
  src/services/vectorMemoryService.ts
  src/services/embeddingService.ts
  src/utils/indexedDBManager.ts
  src/utils/jsonExtract.ts
  src/utils/toast.ts
  src/utils/memoryUtils.ts
  src/components/common/ 大部分通用组件
  src/styles/ 样式系统
  webpack.config.js
  Dockerfile / nginx.conf
  .github/workflows/
```

---

> **当前状态（2026-02-23 二次核验）：改造已完成约 95%。**
>
> **已完成：** 等级/灵魂强度/属性/存档迁移/Prompt（5 模块已注册）/UI（8 新组件 + 8 旧组件适配）/能力树底层/副本世界生成/NPC 常驻模板/关系网络面板/地图路由分流均已就位。
>
> **遗留：** `craftingSystem.ts` 未通用化（仍为炼丹/炼器）、`attributeCalculation.ts` 旧字段兼容路径待清理、`Step1_TemplateSelection.vue` 死代码待删除。
>
> **下一步：** Phase 5（UI 全面美化、副本模板丰富化、数值平衡、存档迁移测试）。
